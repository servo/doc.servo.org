<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Create a new ArrayBuffer with the given contents. The contents must not be modified by any other code, internal or external."><title>NewExternalArrayBuffer in mozjs_sys::jsapi::glue - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-dd39b87e5fcfba68.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="mozjs_sys" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.1 (3f5fd8dd4 2024-08-06)" data-channel="1.80.1" data-search-js="search-d52510db62a78183.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../mozjs_sys/index.html">mozjs_sys</a><span class="version">0.128.3-0</span></h2></div><div class="sidebar-elems"><h2><a href="index.html">In mozjs_sys::jsapi::glue</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Function <a href="../../index.html">mozjs_sys</a>::<wbr><a href="../index.html">jsapi</a>::<wbr><a href="index.html">glue</a>::<wbr><a class="fn" href="#">NewExternalArrayBuffer</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../../src/mozjs_sys/home/runner/work/servo/servo/target/debug/build/mozjs_sys-143fabef74859ace/out/build/jsapi.rs.html#26112-26118">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub unsafe extern &quot;C&quot; fn NewExternalArrayBuffer(
    cx: <a class="primitive" href="https://doc.rust-lang.org/1.80.1/std/primitive.pointer.html">*mut </a><a class="struct" href="../struct.JSContext.html" title="struct mozjs_sys::jsapi::JSContext">JSContext</a>,
    nbytes: <a class="primitive" href="https://doc.rust-lang.org/1.80.1/std/primitive.usize.html">usize</a>,
    contents: <a class="primitive" href="https://doc.rust-lang.org/1.80.1/std/primitive.pointer.html">*mut </a><a class="type" href="https://doc.rust-lang.org/1.80.1/std/os/raw/type.c_void.html" title="type std::os::raw::c_void">c_void</a>,
    freeFunc: <a class="type" href="../JS/type.BufferContentsFreeFunc.html" title="type mozjs_sys::jsapi::JS::BufferContentsFreeFunc">BufferContentsFreeFunc</a>,
    freeUserData: <a class="primitive" href="https://doc.rust-lang.org/1.80.1/std/primitive.pointer.html">*mut </a><a class="type" href="https://doc.rust-lang.org/1.80.1/std/os/raw/type.c_void.html" title="type std::os::raw::c_void">c_void</a>,
) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.80.1/std/primitive.pointer.html">*mut </a><a class="struct" href="../struct.JSObject.html" title="struct mozjs_sys::jsapi::JSObject">JSObject</a></code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Create a new ArrayBuffer with the given contents. The contents must not be
modified by any other code, internal or external.</p>
<p>!!! IMPORTANT !!!
If and only if an ArrayBuffer is successfully created and returned,
ownership of |contents| is transferred to the new ArrayBuffer.</p>
<p>When the ArrayBuffer is ready to be disposed of, <code>freeFunc(contents, freeUserData)</code> will be called to release the ArrayBuffer’s reference on the
contents.</p>
<p><code>freeFunc()</code> must not call any JSAPI functions that could cause a garbage
collection.</p>
<p>The caller must keep the buffer alive until <code>freeFunc()</code> is called, or, if
<code>freeFunc</code> is null, until the JSRuntime is destroyed.</p>
<p>The caller must not access the buffer on other threads. The JS engine will
not allow the buffer to be transferred to other threads. If you try to
transfer an external ArrayBuffer to another thread, the data is copied to a
new malloc buffer. <code>freeFunc()</code> must be threadsafe, and may be called from
any thread.</p>
<p>This allows ArrayBuffers to be used with embedder objects that use reference
counting, for example. In that case the caller is responsible
for incrementing the reference count before passing the contents to this
function. This also allows using non-reference-counted contents that must be
freed with some function other than free().</p>
</div></details></section></div></main></body></html>