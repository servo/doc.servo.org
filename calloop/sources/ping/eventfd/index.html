<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Eventfd based implementation of the ping event source."><title>calloop::sources::ping::eventfd - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-dd39b87e5fcfba68.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="calloop" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.1 (3f5fd8dd4 2024-08-06)" data-channel="1.80.1" data-search-js="search-d52510db62a78183.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../calloop/index.html">calloop</a><span class="version">0.13.0</span></h2></div><h2 class="location"><a href="#">Module eventfd</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In calloop::sources::ping</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../../index.html">calloop</a>::<wbr><a href="../../index.html">sources</a>::<wbr><a href="../index.html">ping</a>::<wbr><a class="mod" href="#">eventfd</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../../../src/calloop/sources/ping/eventfd.rs.html#1-194">source</a> Â· <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Eventfd based implementation of the ping event source.</p>
<h2 id="implementation-notes"><a class="doc-anchor" href="#implementation-notes">Â§</a>Implementation notes</h2>
<p>The eventfd is a much lighter signalling mechanism provided by the Linux
kernel. Rather than write an arbitrary sequence of bytes, it only has a
64-bit counter.</p>
<p>To avoid closing the eventfd early, we wrap it in a RAII-style closer
<code>CloseOnDrop</code> in <code>make_ping()</code>. When all the senders are dropped, another
wrapper <code>FlagOnDrop</code> handles signalling this to the event source, which is
the sole owner of the eventfd itself. The senders have weak references to
the eventfd, and if the source is dropped before the senders, they will
simply not do anything (except log a message).</p>
<p>To differentiate between regular ping events and close ping events, we add 2
to the counter for regular events and 1 for close events. In the source we
can then check the LSB and if itâ€™s set, we know it was a close event. This
only works if a close event never fires more than once.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.ArcAsFd.html" title="struct calloop::sources::ping::eventfd::ArcAsFd">ArcAsFd</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="struct" href="struct.FlagOnDrop.html" title="struct calloop::sources::ping::eventfd::FlagOnDrop">FlagOnDrop</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">This manages signalling to the PingSource when itâ€™s dropped. There should
only ever be one of these per PingSource.</div></li><li><div class="item-name"><a class="struct" href="struct.Ping.html" title="struct calloop::sources::ping::eventfd::Ping">Ping</a></div></li><li><div class="item-name"><a class="struct" href="struct.PingSource.html" title="struct calloop::sources::ping::eventfd::PingSource">PingSource</a></div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.INCREMENT_CLOSE.html" title="constant calloop::sources::ping::eventfd::INCREMENT_CLOSE">INCREMENT_CLOSE</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="constant" href="constant.INCREMENT_PING.html" title="constant calloop::sources::ping::eventfd::INCREMENT_PING">INCREMENT_PING</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.drain_ping.html" title="fn calloop::sources::ping::eventfd::drain_ping">drain_ping</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.make_ping.html" title="fn calloop::sources::ping::eventfd::make_ping">make_ping</a></div></li><li><div class="item-name"><a class="fn" href="fn.send_ping.html" title="fn calloop::sources::ping::eventfd::send_ping">send_ping</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li></ul></section></div></main></body></html>