<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Scene building"><title>webrender::scene_building - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-dd39b87e5fcfba68.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="webrender" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.1 (3f5fd8dd4 2024-08-06)" data-channel="1.80.1" data-search-js="search-d52510db62a78183.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../webrender/index.html">webrender</a><span class="version">0.65.0</span></h2></div><h2 class="location"><a href="#">Module scene_building</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In crate webrender</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">webrender</a>::<wbr><a class="mod" href="#">scene_building</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/webrender/scene_building.rs.html#5-4844">source</a> Â· <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="scene-building"><a class="doc-anchor" href="#scene-building">Â§</a>Scene building</h2>
<p>Scene building is the phase during which display lists, a representation built for
serialization, are turned into a scene, webrenderâ€™s internal representation that is
suited for rendering frames.</p>
<p>This phase is happening asynchronously on the scene builder thread.</p>
<h2 id="general-algorithm"><a class="doc-anchor" href="#general-algorithm">Â§</a>General algorithm</h2>
<p>The important aspects of scene building are:</p>
<ul>
<li>Building up primitive lists (much of the cost of scene building goes here).</li>
<li>Creating pictures for content that needs to be rendered into a surface, be it so that
filters can be applied or for caching purposes.</li>
<li>Maintaining a temporary stack of stacking contexts to keep track of some of the
drawing states.</li>
<li>Stitching multiple display lists which reference each other (without cycles) into
a single scene (see build_reference_frame).</li>
<li>Interning, which detects when some of the retained state stays the same between display
lists.</li>
</ul>
<p>The scene builder linearly traverses the serialized display list which is naturally
ordered back-to-front, accumulating primitives in the top-most stacking contextâ€™s
primitive list.
At the end of each stacking context (see pop_stacking_context), its primitive list is
either handed over to a picture if one is created, or it is concatenated into the parent
stacking contextâ€™s primitive list.</p>
<p>The flow of the algorithm is mostly linear except when handling:</p>
<ul>
<li>shadow stacks (see push_shadow and pop_all_shadows),</li>
<li>backdrop filters (see add_backdrop_filter)</li>
</ul>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.CompositeOps.html" title="struct webrender::scene_building::CompositeOps">CompositeOps</a></div></li><li><div class="item-name"><a class="struct" href="struct.ExtendedPrimitiveInstance.html" title="struct webrender::scene_building::ExtendedPrimitiveInstance">ExtendedPrimitiveInstance</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">A primitive instance + some extra information about the primitive. This is
stored when constructing 3d rendering contexts, which involve cutting
primitive lists.</div></li><li><div class="item-name"><a class="struct" href="struct.FlattenedStackingContext.html" title="struct webrender::scene_building::FlattenedStackingContext">FlattenedStackingContext</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Properties of a stacking context that are maintained
during creation of the scene. These structures are
not persisted after the initial scene build.</div></li><li><div class="item-name"><a class="struct" href="struct.NodeIdToIndexMapper.html" title="struct webrender::scene_building::NodeIdToIndexMapper">NodeIdToIndexMapper</a></div><div class="desc docblock-short">A data structure that keeps track of mapping between API Ids for spatials and the indices
used internally in the SpatialTree to avoid having to do HashMap lookups for primitives
and clips during frame building.</div></li><li><div class="item-name"><a class="struct" href="struct.PendingPrimitive.html" title="struct webrender::scene_building::PendingPrimitive">PendingPrimitive</a></div><div class="desc docblock-short">A primitive that is added while a shadow context is
active is stored as a pending primitive and only
added to pictures during pop_all_shadows.</div></li><li><div class="item-name"><a class="struct" href="struct.PendingShadow.html" title="struct webrender::scene_building::PendingShadow">PendingShadow</a></div><div class="desc docblock-short">As shadows are pushed, they are stored as pending
shadows, and handled at once during pop_all_shadows.</div></li><li><div class="item-name"><a class="struct" href="struct.PictureChainBuilder.html" title="struct webrender::scene_building::PictureChainBuilder">PictureChainBuilder</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Helper struct to build picture chains during scene building from
a flattened stacking context struct.</div></li><li><div class="item-name"><a class="struct" href="struct.SceneBuilder.html" title="struct webrender::scene_building::SceneBuilder">SceneBuilder</a></div><div class="desc docblock-short">A structure that converts a serialized display list into a form that WebRender
can use to later build a frame. This structure produces a BuiltScene. Public
members are typically those that are destructured into the BuiltScene.</div></li><li><div class="item-name"><a class="struct" href="struct.SceneRecycler.html" title="struct webrender::scene_building::SceneRecycler">SceneRecycler</a></div><div class="desc docblock-short">A helper for reusing the scene builderâ€™s memory allocations and dropping
scene allocations on the scene builder thread to avoid lock contention in
jemalloc. </div></li><li><div class="item-name"><a class="struct" href="struct.ScrollOffsetMapper.html" title="struct webrender::scene_building::ScrollOffsetMapper">ScrollOffsetMapper</a></div><div class="desc docblock-short">Offsets primitives (and clips) by the external scroll offset
supplied to scroll nodes.</div></li><li><div class="item-name"><a class="struct" href="struct.SliceFlags.html" title="struct webrender::scene_building::SliceFlags">SliceFlags</a></div><div class="desc docblock-short">Slice flags</div></li><li><div class="item-name"><a class="struct" href="struct.StackingContextInfo.html" title="struct webrender::scene_building::StackingContextInfo">StackingContextInfo</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Internal tracking information about the currently pushed stacking context.
Used to track what operations need to happen when a stacking context is popped.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.PictureSource.html" title="enum webrender::scene_building::PictureSource">PictureSource</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Represents the current input for a picture chain builder (either a
prim list from the stacking context, or a wrapped picture instance).</div></li><li><div class="item-name"><a class="enum" href="enum.ShadowItem.html" title="enum webrender::scene_building::ShadowItem">ShadowItem</a></div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.CreateShadow.html" title="trait webrender::scene_building::CreateShadow">CreateShadow</a></div></li><li><div class="item-name"><a class="trait" href="trait.IsVisible.html" title="trait webrender::scene_building::IsVisible">IsVisible</a></div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.create_prim_instance.html" title="fn webrender::scene_building::create_prim_instance">create_prim_instance</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.filter_datas_for_compositing.html" title="fn webrender::scene_building::filter_datas_for_compositing">filter_datas_for_compositing</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.filter_ops_for_compositing.html" title="fn webrender::scene_building::filter_ops_for_compositing">filter_ops_for_compositing</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.filter_primitives_for_compositing.html" title="fn webrender::scene_building::filter_primitives_for_compositing">filter_primitives_for_compositing</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.process_repeat_size.html" title="fn webrender::scene_building::process_repeat_size">process_repeat_size</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.read_gradient_stops.html" title="fn webrender::scene_building::read_gradient_stops">read_gradient_stops</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li></ul></section></div></main></body></html>