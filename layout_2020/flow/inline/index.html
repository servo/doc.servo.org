<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Inline Formatting Context Layout"><title>layout_2020::flow::inline - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-dd39b87e5fcfba68.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="layout_2020" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.1 (3f5fd8dd4 2024-08-06)" data-channel="1.80.1" data-search-js="search-d52510db62a78183.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../layout_2020/index.html">layout_2020</a><span class="version">0.0.1</span></h2></div><h2 class="location"><a href="#">Module inline</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#statics">Statics</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In layout_2020::flow</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">layout_2020</a>::<wbr><a href="../index.html">flow</a>::<wbr><a class="mod" href="#">inline</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../../src/layout_2020/flow/inline/mod.rs.html#5-2423">source</a> Â· <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="inline-formatting-context-layout"><a class="doc-anchor" href="#inline-formatting-context-layout">Â§</a>Inline Formatting Context Layout</h2>
<p>Inline layout is divided into three phases:</p>
<ol>
<li>Box Tree Construction</li>
<li>Box to Line Layout</li>
<li>Line to Fragment Layout</li>
</ol>
<p>The first phase happens during normal box tree constrution, while the second two phases happen
during fragment tree construction (sometimes called just â€œlayoutâ€).</p>
<h3 id="box-tree-construction"><a class="doc-anchor" href="#box-tree-construction">Â§</a>Box Tree Construction</h3>
<p>During box tree construction, DOM elements are transformed into a box tree. This phase collects
all of the inline boxes, text, atomic inline elements (boxes with <code>display: inline-block</code> or
<code>display: inline-table</code> as well as things like images and canvas), absolutely positioned blocks,
and floated blocks.</p>
<p>During the last part of this phase, whitespace is collapsed and text is segmented into
<a href="text_run/struct.TextRun.html" title="struct layout_2020::flow::inline::text_run::TextRun"><code>TextRun</code></a>s based on script, chosen font, and line breaking opportunities. In addition, default
fonts are selected for every inline box. Each segment of text is shaped using HarfBuzz and
turned into a series of glyphs, which all have a size and a position relative to the origin of
the <a href="text_run/struct.TextRun.html" title="struct layout_2020::flow::inline::text_run::TextRun"><code>TextRun</code></a> (calculated in later phases).</p>
<p>The code for this phase is mainly in <code>construct.rs</code>, but text handling can also be found in
<code>text_runs.rs.</code></p>
<h3 id="box-to-line-layout"><a class="doc-anchor" href="#box-to-line-layout">Â§</a>Box to Line Layout</h3>
<p>During the first phase of fragment tree construction, box tree items are laid out into
<a href="line/enum.LineItem.html" title="enum layout_2020::flow::inline::line::LineItem"><code>LineItem</code></a>s and fragmented based on line boundaries. This is where line breaking happens. This
part of layout fragments boxes and their contents across multiple lines while positioning floats
and making sure non-floated contents flow around them. In addition, all atomic elements are laid
out, which may descend into their respective trees and create fragments. Finally, absolutely
positioned content is collected in order to later hoist it to the containing block for
absolutes.</p>
<p>Note that during this phase, layout does not know the final block position of content. Only
during line to fragment layout, are the final block positions calculated based on the lineâ€™s
final content and its vertical alignment. Instead, positions and line heights are calculated
relative to the lineâ€™s final baseline which will be determined in the final phase.</p>
<p><a href="line/enum.LineItem.html" title="enum layout_2020::flow::inline::line::LineItem"><code>LineItem</code></a>s represent a particular set of content on a line. Currently this is represented by
a linear series of items that describe the lineâ€™s hierarchy of inline boxes and content. The
item types are:</p>
<ul>
<li><a href="line/enum.LineItem.html#variant.LeftInlineBoxPaddingBorderMargin" title="variant layout_2020::flow::inline::line::LineItem::LeftInlineBoxPaddingBorderMargin"><code>LineItem::LeftInlineBoxPaddingBorderMargin</code></a></li>
<li><a href="line/enum.LineItem.html#variant.RightInlineBoxPaddingBorderMargin" title="variant layout_2020::flow::inline::line::LineItem::RightInlineBoxPaddingBorderMargin"><code>LineItem::RightInlineBoxPaddingBorderMargin</code></a></li>
<li><a href="line/enum.LineItem.html#variant.TextRun" title="variant layout_2020::flow::inline::line::LineItem::TextRun"><code>LineItem::TextRun</code></a></li>
<li><a href="line/enum.LineItem.html#variant.Atomic" title="variant layout_2020::flow::inline::line::LineItem::Atomic"><code>LineItem::Atomic</code></a></li>
<li><a href="line/enum.LineItem.html#variant.AbsolutelyPositioned" title="variant layout_2020::flow::inline::line::LineItem::AbsolutelyPositioned"><code>LineItem::AbsolutelyPositioned</code></a></li>
<li><a href="line/enum.LineItem.html#variant.Float" title="variant layout_2020::flow::inline::line::LineItem::Float"><code>LineItem::Float</code></a></li>
</ul>
<p>The code for this can be found by looking for methods of the form <code>layout_into_line_item()</code>.</p>
<h3 id="line-to-fragment-layout"><a class="doc-anchor" href="#line-to-fragment-layout">Â§</a>Line to Fragment Layout</h3>
<p>During the second phase of fragment tree construction, the final block position of <a href="line/enum.LineItem.html" title="enum layout_2020::flow::inline::line::LineItem"><code>LineItem</code></a>s
is calculated and they are converted into <a href="../../fragment_tree/fragment/enum.Fragment.html" title="enum layout_2020::fragment_tree::fragment::Fragment"><code>Fragment</code></a>s. After layout, the <a href="line/enum.LineItem.html" title="enum layout_2020::flow::inline::line::LineItem"><code>LineItem</code></a>s are
discarded and the new fragments are incorporated into the fragment tree. The final static
position of absolutely positioned content is calculated and it is hoisted to its containing
block via <a href="../../positioned/struct.PositioningContext.html" title="struct layout_2020::positioned::PositioningContext"><code>PositioningContext</code></a>.</p>
<p>The code for this phase, can mainly be found in <code>line.rs</code>.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="construct/index.html" title="mod layout_2020::flow::inline::construct">construct</a></div></li><li><div class="item-name"><a class="mod" href="inline_box/index.html" title="mod layout_2020::flow::inline::inline_box">inline_box</a></div></li><li><div class="item-name"><a class="mod" href="line/index.html" title="mod layout_2020::flow::inline::line">line</a></div></li><li><div class="item-name"><a class="mod" href="line_breaker/index.html" title="mod layout_2020::flow::inline::line_breaker">line_breaker</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="mod" href="text_run/index.html" title="mod layout_2020::flow::inline::text_run">text_run</a></div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.BaselineRelativeSize.html" title="struct layout_2020::flow::inline::BaselineRelativeSize">BaselineRelativeSize</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">A block size relative to a lineâ€™s final baseline. This is to track the size
contribution of a particular element of a line above and below the baseline.
These sizes can be combined with other baseline relative sizes before the
final baseline position is known. The values here are relative to the
overall lineâ€™s baseline and <em>not</em> the nested baseline of an inline box.</div></li><li><div class="item-name"><a class="struct" href="struct.ContentSizesComputation.html" title="struct layout_2020::flow::inline::ContentSizesComputation">ContentSizesComputation</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">A struct which takes care of computing <a href="../../sizing/struct.ContentSizes.html" title="struct layout_2020::sizing::ContentSizes"><code>ContentSizes</code></a> for an <a href="struct.InlineFormattingContext.html" title="struct layout_2020::flow::inline::InlineFormattingContext"><code>InlineFormattingContext</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.FontKeyAndMetrics.html" title="struct layout_2020::flow::inline::FontKeyAndMetrics">FontKeyAndMetrics</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">A collection of data used to cache <a href="../../../fonts/font/struct.FontMetrics.html" title="struct fonts::font::FontMetrics"><code>FontMetrics</code></a> in the <a href="struct.InlineFormattingContext.html" title="struct layout_2020::flow::inline::InlineFormattingContext"><code>InlineFormattingContext</code></a></div></li><li><div class="item-name"><a class="struct" href="struct.InlineContainerState.html" title="struct layout_2020::flow::inline::InlineContainerState">InlineContainerState</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="struct" href="struct.InlineContainerStateFlags.html" title="struct layout_2020::flow::inline::InlineContainerStateFlags">InlineContainerStateFlags</a></div></li><li><div class="item-name"><a class="struct" href="struct.InlineFormattingContext.html" title="struct layout_2020::flow::inline::InlineFormattingContext">InlineFormattingContext</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="struct" href="struct.InlineFormattingContextLayout.html" title="struct layout_2020::flow::inline::InlineFormattingContextLayout">InlineFormattingContextLayout</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="struct" href="struct.LineBlockSizes.html" title="struct layout_2020::flow::inline::LineBlockSizes">LineBlockSizes</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="struct" href="struct.LineUnderConstruction.html" title="struct layout_2020::flow::inline::LineUnderConstruction">LineUnderConstruction</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Information about the current line under construction for a particular
<a href="struct.InlineFormattingContextLayout.html" title="struct layout_2020::flow::inline::InlineFormattingContextLayout"><code>InlineFormattingContextLayout</code></a>. This tracks position and size information while
<a href="line/enum.LineItem.html" title="enum layout_2020::flow::inline::line::LineItem"><code>LineItem</code></a>s are collected and is used as input when those <a href="line/enum.LineItem.html" title="enum layout_2020::flow::inline::line::LineItem"><code>LineItem</code></a>s are
converted into <a href="../../fragment_tree/fragment/enum.Fragment.html" title="enum layout_2020::fragment_tree::fragment::Fragment"><code>Fragment</code></a>s during the final phase of line layout. Note that this
does not store the <a href="line/enum.LineItem.html" title="enum layout_2020::flow::inline::line::LineItem"><code>LineItem</code></a>s themselves, as they are stored as part of the
nesting state in the <a href="struct.InlineFormattingContextLayout.html" title="struct layout_2020::flow::inline::InlineFormattingContextLayout"><code>InlineFormattingContextLayout</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.SegmentContentFlags.html" title="struct layout_2020::flow::inline::SegmentContentFlags">SegmentContentFlags</a></div></li><li><div class="item-name"><a class="struct" href="struct.UnbreakableSegmentUnderConstruction.html" title="struct layout_2020::flow::inline::UnbreakableSegmentUnderConstruction">UnbreakableSegmentUnderConstruction</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">The current unbreakable segment under construction for an inline formatting context.
Items accumulate here until we reach a soft line break opportunity during processing
of inline content or we reach the end of the formatting context.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.InlineItem.html" title="enum layout_2020::flow::inline::InlineItem">InlineItem</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li></ul><h2 id="statics" class="section-header">Statics<a href="#statics" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="static" href="static.FONT_SUBSCRIPT_OFFSET_RATIO.html" title="static layout_2020::flow::inline::FONT_SUBSCRIPT_OFFSET_RATIO">FONT_SUBSCRIPT_OFFSET_RATIO</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="static" href="static.FONT_SUPERSCRIPT_OFFSET_RATIO.html" title="static layout_2020::flow::inline::FONT_SUPERSCRIPT_OFFSET_RATIO">FONT_SUPERSCRIPT_OFFSET_RATIO</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.char_prevents_soft_wrap_opportunity_when_before_or_after_atomic.html" title="fn layout_2020::flow::inline::char_prevents_soft_wrap_opportunity_when_before_or_after_atomic">char_prevents_soft_wrap_opportunity_when_before_or_after_atomic</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Whether or not this character will rpevent a soft wrap opportunity when it
comes before or after an atomic inline element.</div></li><li><div class="item-name"><a class="fn" href="fn.effective_vertical_align.html" title="fn layout_2020::flow::inline::effective_vertical_align">effective_vertical_align</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.inline_container_needs_strut.html" title="fn layout_2020::flow::inline::inline_container_needs_strut">inline_container_needs_strut</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="desc docblock-short">Whether or not a strut should be created for an inline container. Normally
all inline containers get struts. In quirks mode this isnâ€™t always the case
though.</div></li><li><div class="item-name"><a class="fn" href="fn.is_baseline_relative.html" title="fn layout_2020::flow::inline::is_baseline_relative">is_baseline_relative</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.line_height.html" title="fn layout_2020::flow::inline::line_height">line_height</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.place_pending_floats.html" title="fn layout_2020::flow::inline::place_pending_floats">place_pending_floats</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></li></ul></section></div></main></body></html>